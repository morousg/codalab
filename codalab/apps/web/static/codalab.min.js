(function(c,e,d){var a=c(document);d=e.Modernizr;c(document).ready(function(){c.fn.foundationAlerts&&a.foundationAlerts();c.fn.foundationButtons&&a.foundationButtons();c.fn.foundationAccordion&&a.foundationAccordion();c.fn.foundationNavigation&&a.foundationNavigation();c.fn.foundationTopBar&&a.foundationTopBar();c.fn.foundationCustomForms&&a.foundationCustomForms();c.fn.foundationMediaQueryViewer&&a.foundationMediaQueryViewer();c.fn.foundationTabs&&a.foundationTabs({callback:c.foundation.customForms.appendCustomMarkup});
c.fn.foundationTooltips&&a.foundationTooltips();c.fn.foundationMagellan&&a.foundationMagellan();c.fn.foundationClearing&&a.foundationClearing();c.fn.placeholder&&c("input, textarea").placeholder()});d.touch&&!e.location.hash&&c(e).load(function(){setTimeout(function(){e.scrollTo(0,1)},0)})})(jQuery,this);var BundleContentNode=function(){function c(c,d,a,b){this.url=c;this.name=d;this.parent=a;this.children=b}c.prototype.isRootNode=function(){return void 0===this.parent};c.prototype.isLeafNode=function(){return null===this.children};c.prototype.getUrl=function(){return this.url};c.prototype.getName=function(){return this.name};c.prototype.getFullName=function(){return this.isRootNode()?this.name:[this.parent.getFullName(),this.name].join("/")};c.prototype.getParent=function(){return this.parent};c.prototype.getChildren=
function(){return this.children};c.prototype.setChildren=function(c){this.children=c};c.prototype.getData=function(){return this.data};c.prototype.setData=function(c){this.data=c};return c}(),BundleRenderer=function(){function c(c){this.template=c}c.loadContentAsync=function(e,d){console.log("loadContentAsync");$.ajax({type:"GET",url:[d.getUrl(),d.getFullName()].join("/"),cache:!1,success:function(a){console.log(a);console.log("");var b=[];Array.isArray(a)&&2==a.length&&(b=a[0].map(function(a){return new BundleContentNode(d.getUrl(),
a,d)}),a=a[1].map(function(a){return new BundleContentNode(d.getUrl(),a,d,null)}),b=b.concat(a).sort(function(a,b){return a.getName().localeCompare(b.getName())}));d.setChildren(b);c.renderTable(e,c.getContentTableModel(d,e))},error:function(a,b,c){}})};c.loadFileContentAsync=function(e,d){console.log("loadFileContentAsync");$.ajax({type:"GET",url:[d.getUrl().replace("api/bundles/content","api/bundles/filecontent"),d.getFullName()].join("/"),cache:!1,success:function(a){console.log(a);console.log("");
d.setData(a);c.renderTable(e,c.getContentTableModel(d,e))},error:function(a,b,c){}})};c.getContentTableModel=function(e,d){var a=0;!1===e.isRootNode()&&(a+=1);if(e.isLeafNode())a+=1;else{var b=e.getChildren();void 0!==b&&(a+=b.length)}var f=function(a){a.setAttribute("class","col bundle__file_view__icon");var b=document.createElement("i");b.setAttribute("class","fi-arrow-left");a.appendChild(b);b.onclick=function(a){c.loadContentAsync(d,e.getParent());a.preventDefault()}},h=function(a){a.setAttribute("class",
"col bundle-item-type-goup");for(var b=[],f=e.getParent();void 0!==f;)b.push(f),f=f.getParent();b.reverse().forEach(function(b){var f=document.createElement("a");f.textContent=b.getName();f.setAttribute("href","");f.onclick=function(a){c.loadContentAsync(d,b);a.preventDefault()};a.appendChild(f);a.appendChild(document.createTextNode(" / "))});a.appendChild(document.createTextNode(e.getName()))},g=function(a,b){a.setAttribute("class","col bundle__file_view__icon");var f=document.createElement("i");
void 0!==b&&f.setAttribute("class",b.isLeafNode()?"fi-page":"fi-folder");a.appendChild(f)},m=function(a,b){if(b.isLeafNode()){a.setAttribute("class","col");var f=document.createElement("a");f.textContent=b.getName();f.setAttribute("href","");f.onclick=function(a){c.loadFileContentAsync(d,b);a.preventDefault()}}else a.setAttribute("class","col bundle-item-type-folder"),f=document.createElement("a"),f.textContent=b.getName(),f.setAttribute("href",""),f.onclick=function(a){c.loadContentAsync(d,b);a.preventDefault()};
a.appendChild(f)},b=function(a,b){var f=document.createElement("img"),c=[b.getUrl().replace("api/bundles/content","api/bundles/filecontent"),b.getFullName()].join("/");f.setAttribute("src",c);f.setAttribute("style","max-width:900px");return[f]},k=function(a,b){var f=document.createElement("iframe"),c=[b.getUrl().replace("api/bundles/content","api/bundles/filecontent"),b.getFullName()].join("/");f.setAttribute("src",c);f.setAttribute("style","width:100%; min-height:"+Math.max(200,Math.min(900,screen.height/
2))+"px;");return[f]},l={txt:function(a,b){var f=document.createElement("pre");f.setAttribute("class","bundle__file_pre");f.textContent=b.getData();return[f]},htm:k,html:k,jpg:b,png:b},n=function(a,b){var f=b.getName(),c="";0<f.indexOf(".")&&(c=f.toLowerCase().split(".").pop());f=l[c];void 0===f&&(f=l.txt);a.setAttribute("class","col");f(a,b).forEach(function(b){a.appendChild(b)})};return{tableDecorations:"bundle__file_view expanded",rowDecorations:"row",numRows:a,numCols:2,render:function(a,b,c){if(!1===
e.isRootNode()&&0>=a)0==b?f(c):h(c);else if(!0===e.isLeafNode())0==b?g(c):n(c,e);else{var d=0;!1===e.isRootNode()&&(d=1);a=e.getChildren()[a-d];0==b?g(c,a):m(c,a)}}}};c.getMetadataTableModel=function(c){var d=[],a;for(a in c.metadata)console.log(a),"description"==a&&d.push([a,c.metadata[a]]);return{tableDecorations:"bundle__meta_table",rowDecorations:"row",numRows:d.length,numCols:2,render:function(a,f,c){0==f?c.setAttribute("class","col bundle__meta_type"):c.setAttribute("class","col");c.textContent=
d[a][f]}}};c.getElementType=function(c,d){return void 0!==c?c:d};c.renderTable=function(e,d){var a=c.getElementType(d.tableElementType,"table"),b=c.getElementType(d.rowElementType,"tr"),f=c.getElementType(d.columnElementType,"td"),a=document.createElement(a);void 0!==d.tableDecorations&&a.setAttribute("class",d.tableDecorations);for(var h=0;h<d.numRows;h++){var g=document.createElement(b);if(0<d.numCols)for(var m=0;m<d.numCols;m++){var k=document.createElement(f);d.render(h,m,k);g.appendChild(k)}else d.render(h,
g);a.appendChild(g)}void 0!=e.firstChild&&e.removeChild(e.firstChild);e.appendChild(a)};c.prototype.render=function(e){var d=$(this.template.cloneNode(!0));d.find(".bundle-name").text(e.metadata.name);d.find(".bundle-icon-sm").removeClass("bundle-icon-sm").addClass("bundle-icon-sm--"+e.bundle_type+"--"+e.state);d.find(".bundle-uuid").text(e.uuid);d.find(".bundle-link").attr("href","/bundles/"+e.uuid);d.find(".bundle-download").on("click",function(a){a.preventDefault();console.log(a);console.log(b.get(0));
root=new BundleContentNode("/api/bundles/content",e.uuid);console.log(root)});var a=d.find(".bundle-meta-view-container").get(0);c.renderTable(a,c.getMetadataTableModel(e));var a=d.find(".bundle__expand_button"),b=d.find(".bundle-file-view-container");a.on("click",function(a){var d=$(a.target);if(d.hasClass("expanded"))b.removeClass("expanded"),b.children().removeClass("expanded"),d.removeClass("expanded"),d.html('SHOW BUNDLE CONTENT<img src="/static/img/expand-arrow.png" alt="More">');else{if(void 0==
b.get(0).firstChild){var g=new BundleContentNode("/api/bundles/content",e.uuid);c.loadContentAsync(b.get(0),g)}else b.children().addClass("expanded");b.addClass("expanded");d.addClass("expanded");d.html('HIDE BUNDLE CONTENT<img src="/static/img/expand-arrow.png" alt="Less">')}a.preventDefault()});return d.get(0)};return c}(),WorkshhetDirectiveRenderer=function(){return function(){var c=this;c.display="inline";c.bundleBlock=null;c.tableDirective=[];c.applyDirective=function(e,d){switch(d[1].directive){case "display":c.display=
d[1].display;c.applyPendingDirectives(e);break;case "image":$(e).append($("<img />",{src:"/api/bundles/filecontent/"+c.bundleBlock.uuid+"/"+encodeURI(d[1].path),"class":"bundleImage",alt:d[1].name}));break;case "metadata":c.tableDirective.push(d[1])}};c.insertRowTable=function(c,d,a){var b=$("<tr></tr>");d.forEach(function(f){b.append($(a).text(f))});c.append(b)};c.getDataFromPath=function(e){return c.bundleBlock.metadata[e]};c.applyPendingDirectives=function(e){if(0<c.tableDirective.length){var d=
$("<table></table>");if("table"===c.display){var a=$("<thead></thead>");c.insertRowTable(a,c.tableDirective.map(function(a){return a.name}),"<th></th>")}var b=$("<tbody></tbody>");"table"===c.display?c.insertRowTable(b,c.tableDirective.map(function(a){return c.getDataFromPath(a.path)}),"<td></td>"):c.tableDirective.forEach(function(a){c.insertRowTable(b,[a.name,c.getDataFromPath(a.path)],"<td></td>")});d.append(a);d.append(b);$(e).append(d);c.tableDirective=[]}}}}(),WorksheetRenderer=function(){return function(c,
e,d){this.renderer=e;if(d&&d.items&&Array.isArray(d.items)){var a=this;e=d.name;var b=d.items.filter(function(a){return"title"===a[2]});0<b.length&&(e=markdown.toHTML("#"+b[0][1]).replace(/^<h1>/,"").replace(/<\/h1>$/,""));$(".worksheet-icon").html(e);$(".worksheet-author").html("by "+d.owner);var f=new WorkshhetDirectiveRenderer,h="";d.items.push([null,"eof",null]);d.items.forEach(function(b,d,e){"directive"!=b[2]&&f.applyPendingDirectives(c);if("markup"!=b[2]&&0<h.length){var l=document.createElement("div");
l.innerHTML=markdown.toHTML(h);c.appendChild(l);h=""}switch(b[2]){case "markup":h+=b[1]+"\n\r";break;case "bundle":c.appendChild(a.renderer.render(b[0]));break;case "directive":e.slice(d+1).forEach(function(a){"bundle"==a[2]&&(f.bundleBlock=a[0])}),f.applyDirective(c,b)}});MathJax.Hub.Queue(["Typeset",MathJax.Hub,c.id]);MathJax.Hub.Queue(function(){for(var a=MathJax.Hub.getAllJax(),b=0;b<a.length;b+=1)$(a[b].SourceElement().parentNode).addClass("coda-jax")})}}}();var Competition;
(function(c){function e(a,b){0<$("#disallow_leaderboard_modifying").length?a.text("Leaderboard modifying disallowed").attr("disabled","disabled"):b?(a.removeClass("leaderBoardSubmit"),a.addClass("leaderBoardRemove"),a.text("Remove from Leaderboard")):(a.removeClass("leaderBoardRemove"),a.addClass("leaderBoardSubmit"),a.text("Submit to Leaderboard"))}function d(a,b,c,d){a="/api/competition/"+a+"/submission/"+b+"/leaderboard";var g="";d.hasClass("leaderBoardSubmit")?g="post":d.hasClass("leaderBoardRemove")&&(g=
"delete");request=$.ajax({url:a,type:g,datatype:"text",data:{csrfmiddlewaretoken:c},success:function(a,c,f){(a="post"==g)?(c=$("#user_results td.status"),c.removeClass("submitted"),c.addClass("not_submitted"),c.html(""),c=$("#"+b+" td.status"),c.addClass("submitted"),c.html('<span class="glyphicon glyphicon-ok"></span>'),$("#user_results button.leaderBoardRemove").each(function(a){e($(this),!1)})):(c=$("#"+b+" td.status"),c.removeClass("submitted"),c.addClass("not_submitted"),c.html(""));e(d,a)},
error:function(a,b,c){alert("An error occurred. Please try again or report the issue")},beforeSend:function(a){a.setRequestHeader("X-CSRFToken",c)}})}c.getPhaseSubmissions=function(a,b,f){$(".competition_submissions").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+a+"/submissions/"+b,cache:!1,success:function(b){$(".competition_submissions").html("").append(b);!1===CodaLab.FileUploader.isSupported()?
($("#fileUploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new CodaLab.FileUploader({buttonId:"fileUploadButton",sasEndpoint:"/api/competition/"+a+"/submission/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(a,b){$("#fileUploadButton").addClass("disabled")},afterSelection:function(a,b){!1===b&&(0<a.files.length&&("type-error"===
a.files[0].errors[0].kind?$("#details").html("Please select a valid file. Only ZIP files are accepted."):$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#fileUploadButton").removeClass("disabled"))},uploadProgress:function(a,b,c){b=100*b/c;$("#details").html("Uploading file <em>"+a.name+"</em>: "+b.toFixed(0)+"% complete.")},uploadError:function(a){$("#details").html("There was an error uploading the file. Please try again.");$("#fileUploadButton").removeClass("disabled")},
uploadSuccess:function(b,f){$("#details").html("Creating new submission...");var d=$("#submission_description_textarea").val();$("#submission_description_textarea").val("");$.ajax({url:"/api/competition/"+a+"/submission?description="+encodeURIComponent(d),type:"post",cache:!1,data:{id:f,name:b.name,type:b.type,size:b.size}}).done(function(a){$("#details").html("");$("#user_results tr.noData").remove();$("#user_results").append(c.displayNewSubmission(a,d));$("#user_results #"+a.id+" .glyphicon-plus").on("click",
function(){c.showOrHideSubmissionDetails(this)});$("#fileUploadButton").removeClass("disabled");$("#user_results #"+a.id+" .glyphicon-plus").click()}).fail(function(a){var b="An unexpected error occurred.";403==a.status&&(b=a.responseJSON.detail);$("#details").html(b);$("#fileUploadButton").removeClass("disabled")})}});$("#user_results .glyphicon-plus").on("click",function(){c.showOrHideSubmissionDetails(this)})},error:function(a,b,c){$(".competition_submissions").html("<div class='alert alert-error'>An error occurred. Please try refreshing the page.</div>")}})};
c.getPhaseResults=function(a,b){$(".competition_results").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+a+"/results/"+b,cache:!1,success:function(a){$(".competition_results").html("").append(a);$(".column-selectable").click(function(a){a=$(this).closest("table");$(a).find(".column-selected").removeClass();$(this).addClass("column-selected");var b=$(this).attr("name");a=a.find("td").filter(function(){return $(this).attr("name")===
b}).addClass("column-selected");if(0<a.length)for(var c=a.slice().sort(function(a,b){var c=parseInt($.text([$(a).find("span")]));isNaN(c)&&(c=1E5);var f=parseInt($.text([$(b).find("span")]));isNaN(f)&&(f=1E5);return c-f}),f=a[0].parentNode.parentNode,c=c.map(function(){return this.parentNode.cloneNode(!0)}),d=0;d<c.length;d++)$(c[d]).find("td.row-position").text($(c[d]).find("td.column-selected span").text()),f.insertBefore(c[d],a[d].parentNode),f.removeChild(a[d].parentNode)})},error:function(a,
b,c){$(".competition_results").html("<div class='alert alert-error'>An error occurred. Please try refreshing the page.</div>")}})};c.registationCanProceed=function(){!0===$("#checkbox").is(":checked")?$("#participateButton").removeClass("disabledStatus"):$("#participateButton").addClass("disabledStatus")};c.displayRegistrationStatus=function(a){var b="";$.ajax({type:"GET",url:"/api/competition/"+a+"/mystatus/",cache:!1,success:function(a){console.log(a);"approved"==a.status?location.reload():"pending"==
a.status?(b="<div class='participateInfoBlock pendingApproval'>",b+="<div class='infoStatusBar'></div>",b+="<div class='labelArea'>",b+="<label class='regApprovLabel'>Your request to participate in this challenge has been received and a decision is pending.</label>",b+="<label></label>",b+="</div>",b+="</div>"):"denied"==a.status&&(b="<div class='participateInfoBlock'>",b+="<div class='infoStatusBar'></div>",b+="<div class='labelArea'>",b+="<label class='regDeniedLabel'>Your request to participate in this challenge has been denied. The reason for your denied registrations is: "+
a.reason+"</label>",b+="<label></label>",b+="</div>",b+="</div>");location.reload()},error:function(a,b,c){$(".competition_results").html("<div class='alert - error'>An error occurred. Please try refreshing the page.</div>")}});return b};c.displayNewSubmission=function(a,b){var f=$("#submission_details_template #submission_row_template tr").clone();$(f).attr("id",a.id.toString());$(f).addClass(c.oddOrEven(a.submission_number));b&&$(f).attr("data-description",b);$(f).children().each(function(b){switch(b){case 0:"finished"===
a.status&&($(this).val("1"),0<$("#forced_to_leaderboard").length&&($(".glyphicon-ok").remove(),$($(f).children("td")[4]).html('<span class="glyphicon glyphicon-ok"></span>')));break;case 1:$(this).html(a.submission_number.toString());break;case 2:$(this).html(a.filename);break;case 3:var d=function(a){a=a.toString();1==a.length&&(a="0"+a);return a},e=new Date(a.submitted_at);b=e.getDate().toString()+"/"+e.getMonth().toString()+"/"+e.getFullYear();var k=e.getHours().toString(),l=d(e.getMinutes()),
d=d(e.getSeconds());$(this).html(b+" "+k+":"+l+":"+d);break;case 4:$(this).html(c.getSubmissionStatus(a.status))}});return f};c.oddOrEven=function(a){return a&1?"odd":"even"};c.getSubmissionStatus=function(a){var b="Unknown";"submitting"===a?b="Submitting":"submitted"===a?b="Submitted":"running"===a?b="Running":"failed"===a?b="Failed":"cancelled"===a?b="Cancelled":"finished"===a&&(b="Finished");return b};c.showOrHideSubmissionDetails=function(a){var b=$(a).parents("tr")[0];if($(a).hasClass("glyphicon-minus"))$(a).removeClass("glyphicon-minus"),
$(a).addClass("glyphicon-plus"),$(b).next("tr.trDetails").remove();else{$(a).removeClass("glyphicon-plus");$(a).addClass("glyphicon-minus");a=$("#submission_details_template .trDetails").clone();a.find(".tdDetails").attr("colspan",b.cells.length);a.find("a").each(function(a){$(this).attr("href",$(this).attr("href").replace("_",b.id))});$(b).attr("data-description")&&a.find(".submission_description").html("Description: <br><pre>"+$(b).attr("data-description")+"</pre>");$(b).attr("data-exception")&&
a.find(".traceback").html("Error: <br><pre>"+$(b).attr("data-exception")+"</pre>");var f=$("#phasestate").val(),h=$(b).find("input[name='state']").val();if(1==f&&1==h){var g=a.find("button");g.removeClass("hide");var f=$(b).find(".status").hasClass("submitted"),m=$("#competitionId").val();e(g,f);g.on("click",function(){d(m,b.id,$("#cstoken").val(),g)})}else{f=$.trim($(b).find(".statusName").html());g=a.find("button").addClass("hide");if("Submitting"===f||"Submitted"===f||"Running"===f)g.removeClass("hide"),
g.text("Refresh status"),g.on("click",function(){c.updateSubmissionStatus($("#competitionId").val(),b.id,this)});"Failed"!==f&&"Cancelled"!==f||a.find("a").removeClass("hide")}$(b).after(a)}};c.updateSubmissionStatus=function(a,b,f){$(f).parents(".submission_details").find(".preloader-handler").append("<div class='competitionPreloader'></div>").children().css({top:"25px",display:"block"});$.ajax({type:"GET",url:"/api/competition/"+a+"/submission/"+b,cache:!1,success:function(e){$("#user_results #"+
b).find(".statusName").html(c.getSubmissionStatus(e.status));if("finished"===e.status)$("#user_results #"+b+"input:hidden").val("1"),1==$("#phasestate").val()?(0<$("#disallow_leaderboard_modifying").length?($(f).text("Leaderboard modifying disallowed").attr("disabled","disabled"),0<$("#forced_to_leaderboard").length&&($(".glyphicon-ok").remove(),$($("#"+b+" td")[4]).html('<span class="glyphicon glyphicon-ok"></span>'))):0==$("#forced_to_leaderboard").length?($(f).addClass("leaderBoardSubmit"),$(f).text("Submit to Leaderboard")):
($(".glyphicon-ok").remove(),$($("#"+b+" td")[4]).html('<span class="glyphicon glyphicon-ok"></span>'),$(f).removeClass("leaderBoardSubmit"),$(f).addClass("leaderBoardRemove"),$(f).text("Remove from Leaderboard")),$(f).unbind("click").off("click").on("click",function(){d(a,b,$("#cstoken").val(),$(f))})):$(f).addClass("hide");else if("failed"===e.status||"cancelled"===e.status)$(f).addClass("hide"),$(f).parent().parent().find("a").removeClass("hide"),e.exception_details&&$('a[href="traceback/'+b+'/"]').parent().html("Error: <br><pre>"+
e.exception_details+"</pre>");$(".competitionPreloader").hide()},error:function(a,b,c){}})};c.initialize=function(){$(document).ready(function(){$("#participate_form").submit(function(a){a.preventDefault();if($("#participateButton").hasClass("disabledStatus"))return!1;$("#result").html("");a=$(this).serialize();var b=$("#competitionId").val();request=$.ajax({url:"/api/competition/"+b+"/participate/",type:"post",dataType:"text",data:a,success:function(a,d,e){$(".content form").replaceWith(c.displayRegistrationStatus(b))},
error:function(a,b,c){alert("There was a problem registering for this competition.")}});return!1});$("#submissions_phase_buttons .btn").each(function(a,b){$(this).click(function(){var a=$.trim($(this).attr("id").replace("submissions_phase_",""));$("#submissions_phase_buttons .btn").removeClass("selected");$(this).addClass("selected");var b=$("#competitionId").val(),d=$("#cstoken").val();c.getPhaseSubmissions(b,a,d)})});$("#results_phase_buttons .btn").each(function(a,b){$(this).click(function(){var a=
$.trim($(this).attr("id").replace("results_phase_",""));$("#results_phase_buttons .btn").removeClass("selected");$(this).addClass("selected");var b=$("#competitionId").val();c.getPhaseResults(b,a)})});$(".top-bar-section ul > li").removeClass("active");$("#liCompetitions").addClass("active");$("#competition-publish-button").click(function(a){a.preventDefault();var b=$(this).parent()[0];request=$.ajax({url:$(this).attr("href"),success:function(a,c,d){console.log("Published competition.");$(b).children("#competition-publish-button").hide();
$(b).children("#competition-delete-button").hide();$(b).children("#competition-unpublish-button").show()},error:function(a,b,c){a=$.parseJSON(a.responseJSON);a.error&&alert(a.error);console.log("Error publishing competition!")}})});$("#competition-unpublish-button").click(function(a){a.preventDefault();var b=$(this).parent()[0];request=$.ajax({url:$(this).attr("href"),success:function(a,c,d){console.log("Unpublished competition.");$(b).children("#competition-publish-button").show();$(b).children("#competition-delete-button").show();
$(b).children("#competition-unpublish-button").hide()},error:function(a,b,c){console.log("Error unpublishing competition!")}})});$("#my_managing .competition-tile .competition-actions").each(function(a,b){"True"==$(this)[0].getAttribute("published")?($(this).find("#competition-delete-button").hide(),$(this).find("#competition-publish-button").hide(),$(this).find("#competition-unpublish-button").show()):($(this).find("#competition-delete-button").show(),$(this).find("#competition-publish-button").show(),
$(this).find("#competition-unpublish-button").hide())})})}})(Competition||(Competition={}));var csrftoken;function csrfSafeMethod(c){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(c)}function sameOrigin(c){var e="//"+document.location.host,d=document.location.protocol+e;return c==d||c.slice(0,d.length+1)==d+"/"||c==e||c.slice(0,e.length+1)==e+"/"||!/^(\/\/|http:|https:).*/.test(c)}$(function(){csrftoken=$.cookie("csrftoken");$.ajaxSetup({beforeSend:function(c,e){!csrfSafeMethod(e.type)&&sameOrigin(e.url)&&c.setRequestHeader("X-CSRFToken",csrftoken)}})});var CodaLab;
(function(c){var e=function(){function c(a){var b=this;this.defaultOptions={buttonId:"fileUploadButton",disabledClassName:"disabled",beforeSelection:function(){},afterSelection:function(a,b){},uploadProgress:function(a,b,c){},uploadSuccess:function(a){},uploadError:function(a){},allowedFileTypes:void 0,extensionToFileType:{zip:"application/zip"},maxFileSizeInBytes:void 0,maxBlockSizeInBytes:1048576};this.options=$.extend({},this.defaultOptions,a);var f=$("#"+this.options.buttonId);this.setupFileInput();
f.after(this.fileInput);f.on("click",function(a){f.hasClass(b.options.disabledClassName)||b.fileInput.click()})}c.prototype.setupFileInput=function(){var a=this,b=this.fileInput;this.fileInput=$(document.createElement("input"));this.fileInput.attr("type","file");this.fileInput.attr("style","visibility: hidden; width: 1px; height: 1px;");this.fileInput.on("change",function(b){a.options.beforeSelection();b=a.validate();var e=0<b.files.length&&!0===c.selectionIsValid(b);a.options.afterSelection(b,e);
e?a.beginUpload(b,0):a.setupFileInput()});void 0!==b&&b.replaceWith(this.fileInput)};c.prototype.validate=function(){var a=this,b=this.fileInput.get(0).files,c=[];0<b.length&&$.each(b,function(b,d){var e=[];a.options.maxFileSizeInBytes&&d.size>a.options.maxFileSizeInBytes&&e.push({kind:"size-error"});var k=d.type;if(""===k){var l=d.name.split(".");1<l.length&&(k=a.options.extensionToFileType[l.pop().toLowerCase()])}a.options.allowedFileTypes&&-1===$.inArray(k,a.options.allowedFileTypes)&&e.push({kind:"type-error"});
c.push({file:d,errors:e})});return{files:c}};c.selectionIsValid=function(a){return 0===a.files.map(function(a){return a.errors.length}).reduce(function(a,c,d,e){return a+c},0)};c.prototype.getCurrentFile=function(){if(void 0!==this.state)return this.state.selection.files[this.state.fileIndex].file};c.prototype.getFileReader=function(){var a=this,b=new FileReader;b.onload=function(b){var c=a.state.sasUrl+"&comp=block&blockid="+a.state.blockIds[a.state.blockIds.length-1];b=new Uint8Array(b.target.result);
var d=a.state.sasVersion;$.ajax({url:c,type:"PUT",data:b,processData:!1,beforeSend:function(a){a.setRequestHeader("x-ms-version",d);a.setRequestHeader("x-ms-blob-type","BlockBlob")},success:function(b,c){var d=a.getCurrentFile();a.options.uploadProgress(d,a.state.bytesUploaded,d.size);a.state.bytesUploaded<d.size?a.upload():a.endUpload()},error:function(b,c,d){a.options.uploadError({kind:"write-error",jqXHR:b,file:a.getCurrentFile()})}})};b.onerror=function(b){a.options.uploadError({kind:"read-error",
message:b.message,file:a.getCurrentFile()})};return b};c.prototype.beginUpload=function(a,b){this.state={sasUrl:void 0,sasVersion:void 0,trackingId:void 0,reader:void 0,selection:a,fileIndex:b,blockIds:[],bytesUploaded:0};var c=this.getCurrentFile(),d=this;$.ajax({url:d.options.sasEndpoint,type:"POST",data:{name:c.name,type:c.type,size:c.size},success:function(a,b){d.state.sasUrl=a.url;d.state.sasVersion=a.version;d.state.trackingId=a.id;d.state.reader=d.getFileReader();d.options.uploadProgress(c,
d.state.bytesUploaded,c.size);d.upload()},error:function(a,b,c){d.options.uploadError({kind:"sas-error",jqXHR:a,file:d.getCurrentFile()})}})};c.prototype.upload=function(){var a=this.getCurrentFile(),b=this.state.bytesUploaded,c=b+Math.min(a.size-b,this.options.maxBlockSizeInBytes),a=a.slice(b,c),b="000000"+(this.state.blockIds.length+1),b=btoa(b.substring(b.length-6));this.state.blockIds.push(b);this.state.bytesUploaded=c;this.state.reader.readAsArrayBuffer(a)};c.prototype.endUpload=function(){var a=
this.state.sasUrl+"&comp=blocklist",b=this.getCurrentFile(),c=['<?xml version="1.0" encoding="utf-8"?>'];c.push("<BlockList>");for(var d=0;d<this.state.blockIds.length;d++)c.push("  <Latest>"+this.state.blockIds[d]+"</Latest>");c.push("</BlockList>");var e=this;$.ajax({url:a,type:"PUT",contentType:"application/xml",processData:!1,data:c.join("\n"),beforeSend:function(a){a.setRequestHeader("x-ms-version",e.state.sasVersion);a.setRequestHeader("x-ms-blob-content-type",b.type);a.setRequestHeader("x-ms-meta-name",
b.name);a.setRequestHeader("x-ms-meta-size",b.size.toString())},success:function(a,c){e.options.uploadSuccess(b,e.state.trackingId);var d=1+e.state.fileIndex;d<e.state.selection.files.length?e.beginUpload(e.state.selection,d):e.setupFileInput()},error:function(a,b,c){e.options.uploadError({kind:"write-error",jqXHR:a,file:e.getCurrentFile()})}})};c.isSupported=function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1};return c}();c.FileUploader=e;(function(c){c.CreateReady=
function(){!1===e.isSupported()?($("#uploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new e({buttonId:"uploadButton",sasEndpoint:"/api/competition/create/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(a,b){$("#uploadButton").addClass("disabled")},afterSelection:function(a,b){!1===b&&(0<a.files.length&&("type-error"===a.files[0].errors[0].kind?
$("#details").html('<div class="alert alert-error">Please select a valid file. Only ZIP files are accepted.</div>'):$("#details").html('<div class="alert alert-error">The files that you selected is too large. There is a 1GB size limit.</div>')),$("#uploadButton").removeClass("disabled"))},uploadProgress:function(a,b,c){b=(100*b/c).toFixed(0);$("#details").html('<div class="alert alert-info">Uploading file <strong>'+a.name+"</strong>: "+b+'% complete.</div><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="'+
b+'" aria-valuemin="0" aria-valuemax="100" style="width: '+b+'%"></div></div>')},uploadError:function(a){$("#details").html('<div class="alert alert-error">There was an error uploading the file. Please try again.</div>');$("#uploadButton").removeClass("disabled")},uploadSuccess:function(a,b){$("#details").html('<div class="alert alert-info alert-waiting">Creating competition... This may take a while. Please be patient.</div>');$.ajax({url:"/api/competition/create",type:"post",cache:!1,data:{id:b,
name:a.name,type:a.type,size:a.size}}).done(function(a){var b=function(){$.ajax({url:"/api/competition/create/"+a.token,type:"get",cache:!1,data:{csrfmiddlewaretoken:$("input[name='csrfmiddlewaretoken']").val()}}).done(function(a){"finished"==a.status?($("#details").html("Congratulations! Your new competition is ready to <a href='/competitions/"+a.id+"'>view</a>. You can also manage it from <a href='/my/#manage'>your CodaLab dashboard.</a>"),$("#uploadButton").removeClass("disabled")):"failed"==a.status?
($("#details").html('<div class="alert alert-error">Oops! There was a problem creating the competition: <br><pre>'+a.error+"</pre></div>"),$("#uploadButton").removeClass("disabled")):setTimeout(b,1E3)}).fail(function(){$("#details").html('<div class="alert alert-error">An unexpected error occurred.</div>');$("#uploadButton").removeClass("disabled")})};b()}).fail(function(){$("#details").html('<div class="alert alert-error">An unexpected error occurred.</div>');$("#uploadButton").removeClass("disabled")})}})}})(c.Competitions||
(c.Competitions={}))})(CodaLab||(CodaLab={}));//# sourceMappingURL=/static/codalab.min.map
